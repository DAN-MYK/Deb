# –î–æ–¥–∞–≤–∞–Ω–Ω—è –ø–æ–ª—ñ–≤ —Ü—ñ–Ω–∏ —Ç–∞ —Å—É–º–∏ –±–µ–∑ –ü–î–í

## üìã –û–≥–ª—è–¥

–î–æ–¥–∞–Ω–æ —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª –¥–ª—è –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è —Ü—ñ–Ω–∏ –∑–∞ –æ–¥–∏–Ω–∏—Ü—é –µ–ª–µ–∫—Ç—Ä–æ–µ–Ω–µ—Ä–≥—ñ—ó –±–µ–∑ –ü–î–í —Ç–∞ —Å—É–º–∏ –±–µ–∑ –ü–î–í —É —Ñ–æ—Ä–º—ñ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –∞–∫—Ç—ñ–≤.

## ‚ú® –ù–æ–≤—ñ —Ñ—É–Ω–∫—Ü—ñ—ó

### 1. –ü–æ–ª—è –≤ —Ñ–æ—Ä–º—ñ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –∞–∫—Ç—ñ–≤

–£ —Ñ–æ—Ä–º—ñ –≤—Ä—É—á–Ω–æ–≥–æ –¥–æ–¥–∞–≤–∞–Ω–Ω—è –∞–∫—Ç—ñ–≤ —Ç–µ–ø–µ—Ä –¥–æ—Å—Ç—É–ø–Ω—ñ —Ç—Ä–∏ —Ñ—ñ–Ω–∞–Ω—Å–æ–≤—ñ –ø–æ–ª—è:

- **–°—É–º–∞ –∑ –ü–î–í** - –∑–∞–≥–∞–ª—å–Ω–∞ —Å—É–º–∞ –∞–∫—Ç—É –∑ –ü–î–í (—ñ—Å–Ω—É—é—á–µ –ø–æ–ª–µ)
- **–°—É–º–∞ –±–µ–∑ –ü–î–í** - –∑–∞–≥–∞–ª—å–Ω–∞ —Å—É–º–∞ –±–µ–∑ –ü–î–í (–Ω–æ–≤–µ –ø–æ–ª–µ)
- **–¶—ñ–Ω–∞ –±–µ–∑ –ü–î–í** - —Ü—ñ–Ω–∞ –∑–∞ –æ–¥–∏–Ω–∏—Ü—é (–≥—Ä–Ω/–∫–í—Ç¬∑–≥–æ–¥) –±–µ–∑ –ü–î–í (–Ω–æ–≤–µ –ø–æ–ª–µ)

### 2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ–±—á–∏—Å–ª–µ–Ω–Ω—è

–§–æ—Ä–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ–±—á–∏—Å–ª—é—î –∑–Ω–∞—á–µ–Ω–Ω—è –ø–æ–ª—ñ–≤ –¥–ª—è –∑—Ä—É—á–Ω–æ—Å—Ç—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞:

#### –°—É–º–∞ –±–µ–∑ –ü–î–í
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ–±—á–∏—Å–ª—é—î—Ç—å—Å—è –ø—Ä–∏ –≤–≤–µ–¥–µ–Ω–Ω—ñ —Å—É–º–∏ –∑ –ü–î–í
- –§–æ—Ä–º—É–ª–∞: `–°—É–º–∞ –±–µ–∑ –ü–î–í = –°—É–º–∞ –∑ –ü–î–í √∑ 1.2`
- –ú–æ–∂–Ω–∞ —Ä–µ–¥–∞–≥—É–≤–∞—Ç–∏ –≤—Ä—É—á–Ω—É

#### –¶—ñ–Ω–∞ –±–µ–∑ –ü–î–í
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ–±—á–∏—Å–ª—é—î—Ç—å—Å—è –ø—Ä–∏ –≤–≤–µ–¥–µ–Ω–Ω—ñ —Å—É–º–∏ –±–µ–∑ –ü–î–í —Ç–∞ –∫—ñ–ª—å–∫–æ—Å—Ç—ñ
- –§–æ—Ä–º—É–ª–∞: `–¶—ñ–Ω–∞ –±–µ–∑ –ü–î–í = –°—É–º–∞ –±–µ–∑ –ü–î–í √∑ –ö—ñ–ª—å–∫—ñ—Å—Ç—å (–∫–í—Ç¬∑–≥–æ–¥)`
- –ú–æ–∂–Ω–∞ —Ä–µ–¥–∞–≥—É–≤–∞—Ç–∏ –≤—Ä—É—á–Ω—É

### 3. –û–±—á–∏—Å–ª–µ–Ω–Ω—è –¥–ª—è PDF –∞–∫—Ç—ñ–≤

–ü—Ä–∏ —ñ–º–ø–æ—Ä—Ç—ñ –∞–∫—Ç—ñ–≤ –∑ PDF —Ñ–∞–π–ª—ñ–≤:
- –Ø–∫—â–æ —î `cost_without_vat` —Ç–∞ `energy_volume`, –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ–±—á–∏—Å–ª—é—î—Ç—å—Å—è `price_without_vat`
- –ó–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è —Ä–∞–∑–æ–º –∑ —ñ–Ω—à–∏–º–∏ –¥–∞–Ω–∏–º–∏ –∞–∫—Ç—É

## üóÑÔ∏è –ó–º—ñ–Ω–∏ –≤ –±–∞–∑—ñ –¥–∞–Ω–∏—Ö

### –ù–æ–≤–∞ –∫–æ–ª–æ–Ω–∫–∞ `price_without_vat`

–î–æ–¥–∞–Ω–æ –¥–æ —Ç–∞–±–ª–∏—Ü—ñ `acts`:

```sql
ALTER TABLE acts ADD COLUMN price_without_vat REAL
```

### –ü–æ–≤–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ñ

```sql
CREATE TABLE acts (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    company TEXT NOT NULL,
    counterparty TEXT NOT NULL,
    period TEXT NOT NULL,
    amount REAL NOT NULL,              -- –°—É–º–∞ –∑ –ü–î–í
    energy_volume REAL,                -- –ö—ñ–ª—å–∫—ñ—Å—Ç—å –∫–í—Ç¬∑–≥–æ–¥
    cost_without_vat REAL,             -- –°—É–º–∞ –±–µ–∑ –ü–î–í
    price_without_vat REAL,            -- –¶—ñ–Ω–∞ –∑–∞ –æ–¥–∏–Ω–∏—Ü—é –±–µ–∑ –ü–î–í
    pdf_path TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
)
```

## üìù –ó–º—ñ–Ω–µ–Ω—ñ —Ñ–∞–π–ª–∏

### Backend

1. **app/core/data/db.py**
   - –î–æ–¥–∞–Ω–æ –∫–æ–ª–æ–Ω–∫—É `price_without_vat` –¥–æ CREATE TABLE
   - –î–æ–¥–∞–Ω–æ –º—ñ–≥—Ä–∞—Ü—ñ—é –¥–ª—è —ñ—Å–Ω—É—é—á–∏—Ö –±–∞–∑ –¥–∞–Ω–∏—Ö
   - –û–Ω–æ–≤–ª–µ–Ω–æ –º–µ—Ç–æ–¥ `save_act()` –¥–ª—è –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ `price_without_vat`
   - –î–æ–¥–∞–Ω–æ –≤–∞–ª—ñ–¥–∞—Ü—ñ—é –Ω–æ–≤–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞

2. **app/core/data/processor.py**
   - –î–æ–¥–∞–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ–±—á–∏—Å–ª–µ–Ω–Ω—è `price_without_vat` –ø—Ä–∏ —ñ–º–ø–æ—Ä—Ç—ñ PDF
   - –§–æ—Ä–º—É–ª–∞: `price_without_vat = cost_without_vat / energy_volume`

### Frontend

3. **app/gui/forms/act.py**
   - –î–æ–¥–∞–Ω–æ –ø–æ–ª–µ "–°—É–º–∞ –±–µ–∑ –ü–î–í" –∑ –∞–≤—Ç–æ–æ–±—á–∏—Å–ª–µ–Ω–Ω—è–º
   - –î–æ–¥–∞–Ω–æ –ø–æ–ª–µ "–¶—ñ–Ω–∞ –±–µ–∑ –ü–î–í" –∑ –∞–≤—Ç–æ–æ–±—á–∏—Å–ª–µ–Ω–Ω—è–º
   - –î–æ–¥–∞–Ω–æ –º–µ—Ç–æ–¥–∏ `_calculate_cost_without_vat()` —Ç–∞ `_calculate_price()`
   - –î–æ–¥–∞–Ω–æ scrollable frame –¥–ª—è –∫—Ä–∞—â–æ–≥–æ UX
   - –û–Ω–æ–≤–ª–µ–Ω–æ –≤–∏—Å–æ—Ç—É –≤—ñ–∫–Ω–∞ –¥–æ 700px
   - –î–æ–¥–∞–Ω–æ –≤—ñ–∑—É–∞–ª—å–Ω–µ –≥—Ä—É–ø—É–≤–∞–Ω–Ω—è —Ñ—ñ–Ω–∞–Ω—Å–æ–≤–∏—Ö –ø–æ–ª—ñ–≤ —É –æ–∫—Ä–µ–º–∏–π frame

## üöÄ –ú—ñ–≥—Ä–∞—Ü—ñ—è —ñ—Å–Ω—É—é—á–∏—Ö –±–∞–∑ –¥–∞–Ω–∏—Ö

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –º—ñ–≥—Ä–∞—Ü—ñ—è

–ë–∞–∑–∞ –¥–∞–Ω–∏—Ö –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫—É –ø—Ä–æ–≥—Ä–∞–º–∏.

### –†—É—á–Ω–∞ –º—ñ–≥—Ä–∞—Ü—ñ—è (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)

–î–ª—è –æ–±—á–∏—Å–ª–µ–Ω–Ω—è —Ü—ñ–Ω–∏ –¥–ª—è –≤—Å—ñ—Ö —ñ—Å–Ω—É—é—á–∏—Ö –∑–∞–ø–∏—Å—ñ–≤:

```bash
python migrate_add_price_field.py
```

–°–∫—Ä–∏–ø—Ç:
- –î–æ–¥–∞—î –∫–æ–ª–æ–Ω–∫—É `price_without_vat`
- –û–±—á–∏—Å–ª—é—î —Ü—ñ–Ω—É –¥–ª—è –≤—Å—ñ—Ö —ñ—Å–Ω—É—é—á–∏—Ö –∞–∫—Ç—ñ–≤, –¥–µ —î `cost_without_vat` —Ç–∞ `energy_volume`
- –ü–æ–∫–∞–∑—É—î –ø—ñ–¥—Å—É–º–æ–∫ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è

## üé® –ü–æ–∫—Ä–∞—â–µ–Ω–Ω—è UI

### –õ–æ–≥—ñ—á–Ω–∞ –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—è –ø–æ–ª—ñ–≤

```
üìù –û—Å–Ω–æ–≤–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è
‚îú‚îÄ‚îÄ –ö–æ–º–ø–∞–Ω—ñ—è
‚îú‚îÄ‚îÄ –ö–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç
‚îú‚îÄ‚îÄ –ü–µ—Ä—ñ–æ–¥
‚îî‚îÄ‚îÄ –ö—ñ–ª—å–∫—ñ—Å—Ç—å (–∫–í—Ç¬∑–≥–æ–¥)

üí∞ –§—ñ–Ω–∞–Ω—Å–æ–≤–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è
‚îú‚îÄ‚îÄ –°—É–º–∞ –∑ –ü–î–í
‚îú‚îÄ‚îÄ –°—É–º–∞ –±–µ–∑ –ü–î–í (–∞–≤—Ç–æ–æ–±—á–∏—Å–ª–µ–Ω–Ω—è: √∑ 1.2)
‚îî‚îÄ‚îÄ –¶—ñ–Ω–∞ –±–µ–∑ –ü–î–í (–∞–≤—Ç–æ–æ–±—á–∏—Å–ª–µ–Ω–Ω—è: —Å—É–º–∞/–∫—ñ–ª—å–∫—ñ—Å—Ç—å)
```

### –í—ñ–∑—É–∞–ª—å–Ω—ñ –ø—ñ–¥–∫–∞–∑–∫–∏

- –§—ñ–Ω–∞–Ω—Å–æ–≤—ñ –ø–æ–ª—è –∑–≥—Ä—É–ø–æ–≤–∞–Ω—ñ —É –≤–∏–¥—ñ–ª–µ–Ω–∏–π frame
- –ü—ñ–¥–∫–∞–∑–∫–∏ –ø—Ä–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ–±—á–∏—Å–ª–µ–Ω–Ω—è —É –Ω–∞–∑–≤–∞—Ö –ø–æ–ª—ñ–≤
- –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ–π–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è: "–ü–æ–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ–±—á–∏—Å–ª—é—é—Ç—å—Å—è, –∞–ª–µ –º–æ–∂–Ω–∞ —Ä–µ–¥–∞–≥—É–≤–∞—Ç–∏"
- Placeholder –∑–Ω–∞—á–µ–Ω–Ω—è –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –ø–æ–ª—è

### –Ü–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å

- **Real-time –æ–±—á–∏—Å–ª–µ–Ω–Ω—è**: –ø–æ–ª—è –æ–Ω–æ–≤–ª—é—é—Ç—å—Å—è –ø—Ä–∏ –≤–≤–µ–¥–µ–Ω–Ω—ñ
- **–†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è**: –º–æ–∂–Ω–∞ –∑–º—ñ–Ω–∏—Ç–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ–±—á–∏—Å–ª–µ–Ω—ñ –∑–Ω–∞—á–µ–Ω–Ω—è
- **Hotkey**: Ctrl+Enter –¥–ª—è —à–≤–∏–¥–∫–æ–≥–æ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è

## üìä –ü—Ä–∏–∫–ª–∞–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

### –°—Ü–µ–Ω–∞—Ä—ñ–π 1: –†—É—á–Ω–µ –≤–≤–µ–¥–µ–Ω–Ω—è –∞–∫—Ç—É

1. –ó–∞–ø–æ–≤–Ω—é—î—Ç–µ –∫–æ–º–ø–∞–Ω—ñ—é, –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç, –ø–µ—Ä—ñ–æ–¥
2. –í–≤–æ–¥–∏—Ç–µ –∫—ñ–ª—å–∫—ñ—Å—Ç—å: `1000` –∫–í—Ç¬∑–≥–æ–¥
3. –í–≤–æ–¥–∏—Ç–µ —Å—É–º—É –∑ –ü–î–í: `1200` –≥—Ä–Ω
4. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ–±—á–∏—Å–ª—é—î—Ç—å—Å—è**:
   - –°—É–º–∞ –±–µ–∑ –ü–î–í: `1000.00` –≥—Ä–Ω (1200 √∑ 1.2)
   - –¶—ñ–Ω–∞ –±–µ–∑ –ü–î–í: `1.0000` –≥—Ä–Ω/–∫–í—Ç¬∑–≥–æ–¥ (1000 √∑ 1000)
5. –ù–∞—Ç–∏—Å–∫–∞—î—Ç–µ "–ó–±–µ—Ä–µ–≥—Ç–∏" –∞–±–æ Ctrl+Enter

### –°—Ü–µ–Ω–∞—Ä—ñ–π 2: –Ü–º–ø–æ—Ä—Ç –∑ PDF

1. –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î—Ç–µ PDF –∞–∫—Ç
2. –°–∏—Å—Ç–µ–º–∞ –≤–∏—Ç—è–≥—É—î:
   - `amount` = 1200 –≥—Ä–Ω (–∑ –ü–î–í)
   - `cost_without_vat` = 1000 –≥—Ä–Ω
   - `energy_volume` = 1000 –∫–í—Ç¬∑–≥–æ–¥
3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ–±—á–∏—Å–ª—é—î—Ç—å—Å—è**:
   - `price_without_vat` = 1.0 –≥—Ä–Ω/–∫–í—Ç¬∑–≥–æ–¥ (1000 √∑ 1000)

## üîç –í–∞–ª—ñ–¥–∞—Ü—ñ—è

–í—Å—ñ –Ω–æ–≤—ñ –ø–æ–ª—è –ø—Ä–æ—Ö–æ–¥—è—Ç—å –≤–∞–ª—ñ–¥–∞—Ü—ñ—é:

- `cost_without_vat`: –º–∞—î –±—É—Ç–∏ –¥–æ–¥–∞—Ç–Ω—ñ–º —á–∏—Å–ª–æ–º
- `price_without_vat`: –º–∞—î –±—É—Ç–∏ –¥–æ–¥–∞—Ç–Ω—ñ–º —á–∏—Å–ª–æ–º
- –ü–æ–ª—è —î –æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–∏–º–∏ (–º–æ–∂—É—Ç—å –±—É—Ç–∏ NULL)

## ‚ö†Ô∏è –ü—Ä–∏–º—ñ—Ç–∫–∏

1. **–û–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ –ø–æ–ª—è**: –≤—Å—ñ –Ω–æ–≤—ñ –ø–æ–ª—è –æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ - –∞–∫—Ç –º–æ–∂–Ω–∞ –∑–±–µ—Ä–µ–≥—Ç–∏ –±–µ–∑ –Ω–∏—Ö
2. **–ê–≤—Ç–æ–æ–±—á–∏—Å–ª–µ–Ω–Ω—è**: –ø—Ä–∞—Ü—é—î –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ, –∞–ª–µ –Ω–µ –±–ª–æ–∫—É—î —Ä—É—á–Ω–µ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è
3. **–ó–≤–æ—Ä–æ—Ç–Ω–∞ —Å—É–º—ñ—Å–Ω—ñ—Å—Ç—å**: —Å—Ç–∞—Ä—ñ –∞–∫—Ç–∏ –∑–∞–ª–∏—à–∞—é—Ç—å—Å—è –±–µ–∑ –∑–º—ñ–Ω, –Ω–æ–≤—ñ –ø–æ–ª—è –±—É–¥—É—Ç—å NULL
4. **–¢–æ—á–Ω—ñ—Å—Ç—å**: —Ü—ñ–Ω–∞ –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –∑ —Ç–æ—á–Ω—ñ—Å—Ç—é –¥–æ 4 –∑–Ω–∞–∫—ñ–≤ –ø—ñ—Å–ª—è –∫–æ–º–∏

## üéØ –ü–µ—Ä–µ–≤–∞–≥–∏

- ‚úÖ –®–≤–∏–¥—à–µ –≤–≤–µ–¥–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö –∑–∞–≤–¥—è–∫–∏ –∞–≤—Ç–æ–æ–±—á–∏—Å–ª–µ–Ω–Ω—é
- ‚úÖ –ú–µ–Ω—à–µ –ø–æ–º–∏–ª–æ–∫ –ø—Ä–∏ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫–∞—Ö
- ‚úÖ –ó–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –¥–µ—Ç–∞–ª—å–Ω–æ—ó —Ñ—ñ–Ω–∞–Ω—Å–æ–≤–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó
- ‚úÖ –ú–æ–∂–ª–∏–≤—ñ—Å—Ç—å –∞–Ω–∞–ª—ñ–∑—É —Ü—ñ–Ω –Ω–∞ –µ–ª–µ–∫—Ç—Ä–æ–µ–Ω–µ—Ä–≥—ñ—é
- ‚úÖ –ó—Ä—É—á–Ω–∏–π UI –∑ –ª–æ–≥—ñ—á–Ω–∏–º –≥—Ä—É–ø—É–≤–∞–Ω–Ω—è–º –ø–æ–ª—ñ–≤
- ‚úÖ –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è —ñ—Å–Ω—É—é—á–∏—Ö –¥–∞–Ω–∏—Ö –ø—Ä–∏ –º—ñ–≥—Ä–∞—Ü—ñ—ó
